#!/bin/bash

concatenated_output=""

# Find all directories named "devRelease" that are not nested under "build"
while read -r dir; do
  # Extract the relative path until a directory called "src" and exclude it
  src_path=$(echo "$dir" | sed -n "s|\(.*\)/src.*|\1|p")

  # Strip leading dot (.) and replace slashes (/) with colons (:)
  src_path=${src_path#.}
  src_path=${src_path//\//:}

  # Append ":detektDevRelease" to the extracted and formatted path
  src_path+=":detektDevRelease"

  # Concatenate the extracted, formatted, and appended path with a space delimiter
  concatenated_output+=" $src_path"
done < <(find . -type d \( -name "devRelease" -o -name "release" \) ! -path "*/build/*")

./gradlew detektDevDebug $concatenated_output "$@"
